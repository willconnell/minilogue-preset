<template>
  <button @click="requestDataDump" style="cursor: pointer">
    Trigger Data Dump
  </button>

  <div
    style="display: flex; direction: column; position: absolute; bottom: 30px"
  >
    <div style="width: 300px; text-align: left">
      Inputs Deteced:
      <ul v-for="device in inputs" :key="device">
        <li style="">{{ device.name }}</li>
      </ul>
    </div>
    <div style="width: 300px; text-align: left">
      Outputs Deteced:
      <ul v-for="device in outputs" :key="device">
        <li style="">{{ device.name }}</li>
      </ul>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      accessGranted: false,
      midiAccess: null,
      channel: 0, // todo: make user configurable
      inputs: [],
      outputs: [],
    };
  },
  mounted() {
    this.requestMidiAccess();
  },
  methods: {
    async requestMidiAccess() {
      const vm = this;
      try {
        // Request access to MIDI devices
        this.midiAccess = await navigator.requestMIDIAccess({
          sysex: true,
        });
        this.accessGranted = true;

        // TODO: user selectable input
        this.midiAccess.inputs.forEach((input) => {
          this.inputs.push(input);
          input.open().then(() => {
            input.onmidimessage = function (e) {
              if (e.data[0] === 0xf0) {
                console.log("REAL MIDI DATA");
                console.log("sysex response", e);
                vm.parseSysex(e.data);
              } else if (e.data[0] != 0xf8) {
                console.log("non clock non sysex", e);
              }
            };
          });
        });
        // add outputs to ref array
        this.midiAccess.outputs.forEach((o) => this.outputs.push(o));
      } catch (error) {
        console.warn("MIDI access denied:", error);
      }
    },
    requestDataDump() {
      if (this.accessGranted && this.midiAccess) {
        this.midiAccess.outputs.forEach((output) => {
          output.open().then(() => {
            const hexChannel = parseInt(`0x3${this.channel}`, 16);
            // send sysex message to request current program data dump
            let message = [
              0xf0, // Start of Exclusive (Sysex) message
              0x42, // Manufacturer ID (Korg)
              hexChannel, // midi channel
              0x00,
              0x01,
              0x51, // Command ID (CURRENT PROGRAM DATA DUMP REQUEST)
              0x10,
              0xf7, // End of Exclusive (Sysex) message
            ];
            output.send(message);
          });
        });
      }

      // use test data when no midi device connected
      if (this.inputs.length === 0 && this.outputs.length === 0) {
        console.log("TEST DATA");
        const x = {
          0: 240,
          1: 66,
          2: 48,
          3: 0,
          4: 1,
          5: 81,
          6: 64,
          7: 0,
          8: 80,
          9: 82,
          10: 79,
          11: 71,
          12: 77,
          13: 105,
          14: 110,
          15: 0,
          16: 105,
          17: 32,
          18: 77,
          19: 111,
          20: 111,
          21: 110,
          22: 0,
          23: 0,
          24: 0,
          25: 0,
          26: 2,
          27: 0,
          28: 0,
          29: 0,
          30: 0,
          31: 0,
          32: 4,
          33: 0,
          34: 1,
          35: 0,
          36: 2,
          37: 0,
          38: 0,
          39: 0,
          40: 0,
          41: 1,
          42: 0,
          43: 2,
          44: 0,
          45: 0,
          46: 0,
          47: 0,
          48: 0,
          49: 0,
          50: 0,
          51: 1,
          52: 0,
          53: 0,
          54: 0,
          55: 0,
          56: 0,
          57: 0,
          58: 0,
          59: 0,
          60: 0,
          61: 0,
          62: 0,
          63: 0,
          64: 0,
          65: 0,
          66: 0,
          67: 0,
          68: 0,
          69: 0,
          70: 0,
          71: 20,
          72: 0,
          73: 0,
          74: 127,
          75: 3,
          76: 127,
          77: 3,
          78: 0,
          79: 0,
          80: 0,
          81: 0,
          82: 0,
          83: 0,
          84: 0,
          85: 77,
          86: 2,
          87: 5,
          88: 127,
          89: 3,
          90: 24,
          91: 2,
          92: 0,
          93: 0,
          94: 0,
          95: 0,
          96: 2,
          97: 0,
          98: 2,
          99: 0,
          100: 1,
          101: 1,
          102: 0,
          103: 0,
          104: 0,
          105: 0,
          106: 2,
          107: 2,
          108: 0,
          109: 1,
          110: 0,
          111: 80,
          112: 0,
          113: 0,
          114: 0,
          115: 0,
          116: 127,
          117: 1,
          118: 127,
          119: 8,
          120: 1,
          121: 1,
          122: 4,
          123: 87,
          124: 2,
          125: 72,
          126: 2,
          127: 20,
          128: 0,
          129: 0,
          130: 127,
          131: 1,
          132: 62,
          133: 3,
          134: 2,
          135: 4,
          136: 2,
          137: 10,
          138: 72,
          139: 20,
          140: 30,
          141: 0,
          142: 4,
          143: 1,
          144: 72,
          145: 12,
          146: 0,
          147: 0,
          148: 12,
          149: 50,
          150: 0,
          151: 0,
          152: 1,
          153: 0,
          154: 0,
          155: 0,
          156: 1,
          157: 0,
          158: 1,
          159: 32,
          160: 1,
          161: 1,
          162: 107,
          163: 100,
          164: 110,
          165: 2,
          166: 100,
          167: 0,
          168: 6,
          169: 100,
          170: 0,
          171: 0,
          172: 0,
          173: 0,
          174: 0,
          175: 86,
          176: 0,
          177: 127,
          178: 127,
          179: 13,
          180: 127,
          181: 1,
          182: 127,
          183: 0,
          184: 1,
          185: 23,
          186: 80,
          187: 82,
          188: 69,
          189: 68,
          190: 83,
          191: 14,
          192: 81,
          193: 127,
          194: 127,
          195: 110,
          196: 2,
          197: 16,
          198: 2,
          199: 48,
          200: 75,
          201: 71,
          202: 0,
          203: 0,
          204: 127,
          205: 127,
          206: 3,
          207: 0,
          208: 17,
          209: 0,
          210: 0,
          211: 0,
          212: 0,
          213: 0,
          214: 0,
          215: 3,
          216: 127,
          217: 127,
          218: 0,
          219: 0,
          220: 0,
          221: 0,
          222: 0,
          223: 0,
          224: 0,
          225: 79,
          226: 51,
          227: 58,
          228: 63,
          229: 0,
          230: 0,
          231: 0,
          232: 0,
          233: 0,
          234: 59,
          235: 87,
          236: 47,
          237: 40,
          238: 0,
          239: 120,
          240: 0,
          241: 0,
          242: 0,
          243: 71,
          244: 71,
          245: 71,
          246: 71,
          247: 0,
          248: 0,
          249: 0,
          250: 0,
          251: 0,
          252: 0,
          253: 0,
          254: 0,
          255: 0,
          256: 0,
          257: 0,
          258: 85,
          259: 1,
          260: 0,
          261: 0,
          262: 0,
          263: 0,
          264: 0,
          265: 0,
          266: 0,
          267: 0,
          268: 0,
          269: 0,
          270: 0,
          271: 0,
          272: 0,
          273: 0,
          274: 0,
          275: 0,
          276: 0,
          277: 0,
          278: 0,
          279: 0,
          280: 0,
          281: 0,
          282: 0,
          283: 0,
          284: 77,
          285: 51,
          286: 58,
          287: 0,
          288: 63,
          289: 0,
          290: 0,
          291: 0,
          292: 0,
          293: 76,
          294: 47,
          295: 64,
          296: 44,
          297: 38,
          298: 0,
          299: 0,
          300: 0,
          301: 0,
          302: 71,
          303: 7,
          304: 71,
          305: 71,
          306: 71,
          307: 0,
          308: 0,
          309: 0,
          310: 0,
          311: 0,
          312: 0,
          313: 0,
          314: 0,
          315: 0,
          316: 0,
          317: 85,
          318: 1,
          319: 0,
          320: 0,
          321: 0,
          322: 0,
          323: 0,
          324: 0,
          325: 0,
          326: 0,
          327: 0,
          328: 0,
          329: 0,
          330: 0,
          331: 0,
          332: 0,
          333: 0,
          334: 0,
          335: 0,
          336: 0,
          337: 0,
          338: 0,
          339: 0,
          340: 0,
          341: 0,
          342: 0,
          343: 0,
          344: 75,
          345: 51,
          346: 58,
          347: 63,
          348: 0,
          349: 0,
          350: 0,
          351: 0,
          352: 0,
          353: 48,
          354: 40,
          355: 47,
          356: 42,
          357: 0,
          358: 0,
          359: 60,
          360: 0,
          361: 0,
          362: 71,
          363: 71,
          364: 71,
          365: 71,
          366: 0,
          367: 0,
          368: 0,
          369: 0,
          370: 0,
          371: 0,
          372: 0,
          373: 0,
          374: 0,
          375: 0,
          376: 0,
          377: 85,
          378: 1,
          379: 0,
          380: 0,
          381: 0,
          382: 0,
          383: 0,
          384: 0,
          385: 0,
          386: 0,
          387: 0,
          388: 0,
          389: 0,
          390: 0,
          391: 0,
          392: 0,
          393: 0,
          394: 0,
          395: 0,
          396: 0,
          397: 0,
          398: 0,
          399: 0,
          400: 0,
          401: 0,
          402: 0,
          403: 51,
          404: 58,
          405: 72,
          406: 0,
          407: 0,
          408: 0,
          409: 0,
          410: 0,
          411: 0,
          412: 45,
          413: 47,
          414: 62,
          415: 96,
          416: 0,
          417: 0,
          418: 0,
          419: 0,
          420: 0,
          421: 71,
          422: 71,
          423: 1,
          424: 71,
          425: 0,
          426: 0,
          427: 0,
          428: 0,
          429: 0,
          430: 0,
          431: 0,
          432: 0,
          433: 0,
          434: 0,
          435: 0,
          436: 85,
          437: 1,
          438: 0,
          439: 0,
          440: 0,
          441: 0,
          442: 0,
          443: 0,
          444: 0,
          445: 0,
          446: 0,
          447: 0,
          448: 0,
          449: 0,
          450: 0,
          451: 0,
          452: 0,
          453: 0,
          454: 0,
          455: 0,
          456: 0,
          457: 0,
          458: 0,
          459: 0,
          460: 0,
          461: 0,
          462: 53,
          463: 0,
          464: 68,
          465: 60,
          466: 63,
          467: 0,
          468: 0,
          469: 0,
          470: 0,
          471: 0,
          472: 41,
          473: 48,
          474: 61,
          475: 52,
          476: 0,
          477: 0,
          478: 0,
          479: 30,
          480: 0,
          481: 71,
          482: 71,
          483: 71,
          484: 71,
          485: 0,
          486: 0,
          487: 0,
          488: 0,
          489: 0,
          490: 0,
          491: 0,
          492: 0,
          493: 0,
          494: 0,
          495: 0,
          496: 85,
          497: 1,
          498: 0,
          499: 0,
          500: 0,
          501: 0,
          502: 0,
          503: 0,
          504: 0,
          505: 0,
          506: 0,
          507: 0,
          508: 0,
          509: 0,
          510: 0,
          511: 0,
          512: 0,
          513: 0,
          514: 0,
          515: 0,
          516: 0,
          517: 0,
          518: 0,
          519: 0,
          520: 0,
          521: 0,
          522: 53,
          523: 67,
          524: 63,
          525: 70,
          526: 0,
          527: 0,
          528: 0,
          529: 0,
          530: 0,
          531: 52,
          532: 42,
          533: 30,
          534: 48,
          535: 112,
          536: 0,
          537: 0,
          538: 0,
          539: 0,
          540: 71,
          541: 71,
          542: 71,
          543: 1,
          544: 71,
          545: 0,
          546: 0,
          547: 0,
          548: 0,
          549: 0,
          550: 0,
          551: 0,
          552: 0,
          553: 0,
          554: 0,
          555: 85,
          556: 1,
          557: 0,
          558: 0,
          559: 0,
          560: 0,
          561: 0,
          562: 0,
          563: 0,
          564: 0,
          565: 0,
          566: 0,
          567: 0,
          568: 0,
          569: 0,
          570: 0,
          571: 0,
          572: 0,
          573: 0,
          574: 0,
          575: 0,
          576: 0,
          577: 0,
          578: 0,
          579: 0,
          580: 0,
          581: 53,
          582: 60,
          583: 0,
          584: 63,
          585: 68,
          586: 0,
          587: 0,
          588: 0,
          589: 0,
          590: 58,
          591: 0,
          592: 59,
          593: 52,
          594: 70,
          595: 0,
          596: 0,
          597: 0,
          598: 0,
          599: 15,
          600: 71,
          601: 71,
          602: 71,
          603: 71,
          604: 0,
          605: 0,
          606: 0,
          607: 0,
          608: 0,
          609: 0,
          610: 0,
          611: 0,
          612: 0,
          613: 0,
          614: 85,
          615: 0,
          616: 1,
          617: 0,
          618: 0,
          619: 0,
          620: 0,
          621: 0,
          622: 0,
          623: 0,
          624: 0,
          625: 0,
          626: 0,
          627: 0,
          628: 0,
          629: 0,
          630: 0,
          631: 0,
          632: 0,
          633: 0,
          634: 0,
          635: 0,
          636: 0,
          637: 0,
          638: 0,
          639: 0,
          640: 0,
          641: 53,
          642: 60,
          643: 65,
          644: 70,
          645: 0,
          646: 0,
          647: 0,
          648: 0,
          649: 0,
          650: 45,
          651: 54,
          652: 41,
          653: 99,
          654: 0,
          655: 120,
          656: 0,
          657: 0,
          658: 0,
          659: 71,
          660: 71,
          661: 71,
          662: 71,
          663: 0,
          664: 0,
          665: 0,
          666: 0,
          667: 0,
          668: 0,
          669: 0,
          670: 0,
          671: 0,
          672: 0,
          673: 0,
          674: 85,
          675: 1,
          676: 0,
          677: 0,
          678: 0,
          679: 0,
          680: 0,
          681: 0,
          682: 0,
          683: 0,
          684: 0,
          685: 0,
          686: 0,
          687: 0,
          688: 0,
          689: 0,
          690: 0,
          691: 0,
          692: 0,
          693: 0,
          694: 0,
          695: 0,
          696: 0,
          697: 0,
          698: 0,
          699: 0,
          700: 80,
          701: 56,
          702: 72,
          703: 0,
          704: 63,
          705: 0,
          706: 0,
          707: 0,
          708: 0,
          709: 46,
          710: 48,
          711: 64,
          712: 46,
          713: 48,
          714: 0,
          715: 0,
          716: 0,
          717: 0,
          718: 71,
          719: 7,
          720: 71,
          721: 71,
          722: 71,
          723: 0,
          724: 0,
          725: 0,
          726: 0,
          727: 0,
          728: 0,
          729: 0,
          730: 0,
          731: 0,
          732: 0,
          733: 85,
          734: 1,
          735: 0,
          736: 0,
          737: 0,
          738: 0,
          739: 0,
          740: 0,
          741: 0,
          742: 0,
          743: 0,
          744: 0,
          745: 0,
          746: 0,
          747: 0,
          748: 0,
          749: 0,
          750: 0,
          751: 0,
          752: 0,
          753: 0,
          754: 0,
          755: 0,
          756: 0,
          757: 0,
          758: 0,
          759: 0,
          760: 79,
          761: 56,
          762: 63,
          763: 72,
          764: 0,
          765: 0,
          766: 0,
          767: 0,
          768: 0,
          769: 58,
          770: 42,
          771: 47,
          772: 59,
          773: 0,
          774: 0,
          775: 60,
          776: 0,
          777: 0,
          778: 71,
          779: 71,
          780: 71,
          781: 71,
          782: 0,
          783: 0,
          784: 0,
          785: 0,
          786: 0,
          787: 0,
          788: 0,
          789: 0,
          790: 0,
          791: 0,
          792: 0,
          793: 85,
          794: 1,
          795: 0,
          796: 0,
          797: 0,
          798: 0,
          799: 0,
          800: 0,
          801: 0,
          802: 0,
          803: 0,
          804: 0,
          805: 0,
          806: 0,
          807: 0,
          808: 0,
          809: 0,
          810: 0,
          811: 0,
          812: 0,
          813: 0,
          814: 0,
          815: 0,
          816: 0,
          817: 0,
          818: 0,
          819: 77,
          820: 56,
          821: 63,
          822: 0,
          823: 0,
          824: 0,
          825: 0,
          826: 0,
          827: 0,
          828: 45,
          829: 44,
          830: 70,
          831: 96,
          832: 0,
          833: 0,
          834: 0,
          835: 0,
          836: 0,
          837: 71,
          838: 71,
          839: 1,
          840: 71,
          841: 0,
          842: 0,
          843: 0,
          844: 0,
          845: 0,
          846: 0,
          847: 0,
          848: 0,
          849: 0,
          850: 0,
          851: 0,
          852: 85,
          853: 1,
          854: 0,
          855: 0,
          856: 0,
          857: 0,
          858: 0,
          859: 0,
          860: 0,
          861: 0,
          862: 0,
          863: 0,
          864: 0,
          865: 0,
          866: 0,
          867: 0,
          868: 0,
          869: 0,
          870: 0,
          871: 0,
          872: 0,
          873: 0,
          874: 0,
          875: 0,
          876: 0,
          877: 0,
          878: 75,
          879: 0,
          880: 56,
          881: 63,
          882: 72,
          883: 0,
          884: 0,
          885: 0,
          886: 0,
          887: 0,
          888: 44,
          889: 45,
          890: 47,
          891: 58,
          892: 0,
          893: 0,
          894: 0,
          895: 30,
          896: 0,
          897: 71,
          898: 71,
          899: 71,
          900: 71,
          901: 0,
          902: 0,
          903: 0,
          904: 0,
          905: 0,
          906: 0,
          907: 0,
          908: 0,
          909: 0,
          910: 0,
          911: 0,
          912: 85,
          913: 1,
          914: 0,
          915: 0,
          916: 0,
          917: 0,
          918: 0,
          919: 0,
          920: 0,
          921: 0,
          922: 0,
          923: 0,
          924: 0,
          925: 0,
          926: 0,
          927: 0,
          928: 0,
          929: 0,
          930: 0,
          931: 0,
          932: 0,
          933: 0,
          934: 0,
          935: 0,
          936: 0,
          937: 0,
          938: 75,
          939: 51,
          940: 58,
          941: 0,
          942: 0,
          943: 0,
          944: 0,
          945: 0,
          946: 0,
          947: 43,
          948: 32,
          949: 36,
          950: 0,
          951: 112,
          952: 0,
          953: 0,
          954: 0,
          955: 0,
          956: 71,
          957: 71,
          958: 71,
          959: 0,
          960: 0,
          961: 0,
          962: 0,
          963: 0,
          964: 0,
          965: 0,
          966: 0,
          967: 0,
          968: 0,
          969: 0,
          970: 0,
          971: 85,
          972: 1,
          973: 0,
          974: 0,
          975: 0,
          976: 0,
          977: 0,
          978: 0,
          979: 0,
          980: 0,
          981: 0,
          982: 0,
          983: 0,
          984: 0,
          985: 0,
          986: 0,
          987: 0,
          988: 0,
          989: 0,
          990: 0,
          991: 0,
          992: 0,
          993: 0,
          994: 0,
          995: 0,
          996: 0,
          997: 70,
          998: 51,
          999: 0,
          1000: 58,
          1001: 65,
          1002: 0,
          1003: 0,
          1004: 0,
          1005: 0,
          1006: 48,
          1007: 0,
          1008: 46,
          1009: 44,
          1010: 48,
          1011: 0,
          1012: 0,
          1013: 0,
          1014: 0,
          1015: 15,
          1016: 71,
          1017: 71,
          1018: 71,
          1019: 71,
          1020: 0,
          1021: 0,
          1022: 0,
          1023: 0,
          1024: 0,
          1025: 0,
          1026: 0,
          1027: 0,
          1028: 0,
          1029: 0,
          1030: 85,
          1031: 0,
          1032: 1,
          1033: 0,
          1034: 0,
          1035: 0,
          1036: 0,
          1037: 0,
          1038: 0,
          1039: 0,
          1040: 0,
          1041: 0,
          1042: 0,
          1043: 0,
          1044: 0,
          1045: 0,
          1046: 0,
          1047: 0,
          1048: 0,
          1049: 0,
          1050: 0,
          1051: 0,
          1052: 0,
          1053: 0,
          1054: 0,
          1055: 0,
          1056: 0,
          1057: 51,
          1058: 58,
          1059: 67,
          1060: 0,
          1061: 0,
          1062: 0,
          1063: 0,
          1064: 0,
          1065: 0,
          1066: 46,
          1067: 46,
          1068: 68,
          1069: 0,
          1070: 0,
          1071: 56,
          1072: 0,
          1073: 0,
          1074: 0,
          1075: 71,
          1076: 71,
          1077: 71,
          1078: 0,
          1079: 0,
          1080: 0,
          1081: 0,
          1082: 0,
          1083: 0,
          1084: 0,
          1085: 0,
          1086: 0,
          1087: 0,
          1088: 0,
          1089: 0,
          1090: 85,
          1091: 1,
          1092: 0,
          1093: 0,
          1094: 0,
          1095: 0,
          1096: 0,
          1097: 0,
          1098: 0,
          1099: 0,
          1100: 0,
          1101: 0,
          1102: 0,
          1103: 0,
          1104: 0,
          1105: 0,
          1106: 0,
          1107: 0,
          1108: 0,
          1109: 0,
          1110: 0,
          1111: 0,
          1112: 0,
          1113: 0,
          1114: 0,
          1115: 0,
          1116: 51,
          1117: 58,
          1118: 67,
          1119: 0,
          1120: 70,
          1121: 0,
          1122: 0,
          1123: 0,
          1124: 0,
          1125: 44,
          1126: 42,
          1127: 64,
          1128: 48,
          1129: 47,
          1130: 0,
          1131: 0,
          1132: 0,
          1133: 0,
          1134: 71,
          1135: 7,
          1136: 71,
          1137: 71,
          1138: 71,
          1139: 0,
          1140: 0,
          1141: 0,
          1142: 0,
          1143: 0,
          1144: 0,
          1145: 0,
          1146: 0,
          1147: 0,
          1148: 0,
          1149: 85,
          1150: 1,
          1151: 0,
          1152: 0,
          1153: 0,
          1154: 0,
          1155: 0,
          1156: 0,
          1157: 0,
          1158: 0,
          1159: 0,
          1160: 0,
          1161: 0,
          1162: 0,
          1163: 0,
          1164: 0,
          1165: 0,
          1166: 0,
          1167: 0,
          1168: 0,
          1169: 0,
          1170: 0,
          1171: 0,
          1172: 0,
          1173: 0,
          1174: 0,
          1175: 0,
          1176: 60,
          1177: 5,
          1178: 247,
        };
        let testRes = new Uint8Array(Object.values(x));
        this.parseSysex(testRes);
      }
    },
    parseSysex(sysexResponse) {
      const header = sysexResponse.slice(0, 7);
      const data = sysexResponse.slice(7, sysexResponse.length);
      let headerString = "header: ";
      if (this.isDataDump(header)) headerString += "is data dump";
      else headerString += "not data dump";
      console.log(headerString);

      const converted = this.convertSysex(data);
      console.log("converted 8 bit data", converted);
      const program = this.createProgramObj(converted);
      console.log("program obj", program);
    },
    convertSysex(input) {
      let output = [];
      for (let i = 0; i < input.length; i += 8) {
        let chunk = input.slice(i, i + 8);
        let mask = 1;
        let leftShift = 7;
        for (let j = 1; j < 8; j++) {
          output.push(chunk[j] | ((chunk[0] & mask) << leftShift));
          mask <<= 1;
          leftShift -= 1;
        }
      }
      return new Uint8Array(output);
    },
    isDataDump(header) {
      const currentProgramDataDump = [0xf0, 0x42, 0x30, 0x00, 0x01, 0x51, 0x40];
      return header.every((val, i) => val === currentProgramDataDump[i]);
    },
    createProgramObj(converted) {
      const dataview = new DataView(converted.buffer);
      const decoder = new TextDecoder("utf-8");
      const program = {};

      program.prog = decoder.decode(converted.subarray(0, 4));
      program.progName = decoder.decode(converted.subarray(4, 16));
      program.octave = dataview.getInt8(16);
      program.portamento = dataview.getInt8(17);
      program.keyTrig = dataview.getInt8(18);
      program.voiceModeDepth = dataview.getInt16(19, true); // little endian
      program.voiceModeType = dataview.getInt8(21);
      program.vco1Wave = dataview.getInt8(22);
      program.vco1Octave = dataview.getInt8(23);
      program.vco1Pitch = dataview.getInt16(24, true);
      program.vco1Shape = dataview.getInt16(26, true);
      program.vco2Wave = dataview.getInt8(28);
      program.vco2Octave = dataview.getInt8(29);
      program.vco2Pitch = dataview.getInt16(30, true);
      program.vco2Shape = dataview.getInt16(32, true);
      program.sync = dataview.getInt8(34);
      program.ring = dataview.getInt8(35);
      program.crossModDepth = dataview.getInt16(36, true);
      program.multiType = dataview.getInt8(38);
      program.selectNoise = dataview.getInt8(39);
      program.selectVPM = dataview.getInt8(40);
      program.selectUser = dataview.getInt8(41);
      program.shapeNoise = dataview.getInt16(42, true);
      program.shapeVPM = dataview.getInt16(44, true);
      program.shapeUser = dataview.getInt16(46, true);
      program.shiftShapeNoise = dataview.getInt16(48, true);
      program.shiftShapeVPM = dataview.getInt16(50, true);
      program.shiftShapeUser = dataview.getInt16(52, true);
      program.vco1Level = dataview.getInt16(54, true);
      program.vco2Level = dataview.getInt16(56, true);
      program.multiLevel = dataview.getInt16(58, true);
      program.cutoff = dataview.getInt16(60, true);
      program.resonance = dataview.getInt16(62, true);
      program.cutoffDrive = dataview.getInt8(64);
      program.cutoffKeyTrack = dataview.getInt8(65);
      program.ampEGAttack = dataview.getInt16(66, true);
      program.ampEGDecay = dataview.getInt16(68, true);
      program.ampEGSustain = dataview.getInt16(70, true);
      program.ampEGRelease = dataview.getInt16(72, true);
      program.egAttack = dataview.getInt16(74, true);
      program.egDecay = dataview.getInt16(76, true);
      program.egInt = dataview.getInt16(78, true);
      program.egTarget = dataview.getInt8(80); // 0~2=CUTOFF, PITCH2, PITCH
      program.lfoWave = dataview.getInt8(81);
      program.lfoMode = dataview.getInt8(82); // 0~2=1-SHOT,NORMAL,BPM
      program.lfoRate = dataview.getInt16(83, true);
      program.lfoInt = dataview.getInt16(85, true);
      program.lfoTarget = dataview.getInt8(87); // 0~2=CUTOFF,SHAPE,PITCH
      program.modFxIO = dataview.getInt8(88);
      program.modFxType = dataview.getInt8(89);
      program.modFxChorus = dataview.getInt8(90);
      program.modFxEnsemble = dataview.getInt8(91);
      program.modFxPhaser = dataview.getInt8(92);
      program.modFxFlanger = dataview.getInt8(93);
      program.modFxUser = dataview.getInt8(94);
      program.modFxTime = dataview.getInt16(95, true);
      program.modFxDepth = dataview.getInt16(97, true);
      program.delayIO = dataview.getInt8(99);
      program.delaySubTye = dataview.getInt8(100);
      program.delayTime = dataview.getInt16(101, true);
      program.delayDepth = dataview.getInt16(103, true);
      program.reverbIO = dataview.getInt8(105);
      program.reverbSubType = dataview.getInt8(106);
      program.reverbTime = dataview.getInt16(107, true);
      program.reverbDepth = dataview.getInt16(109, true);
      program.bendRangePlus = dataview.getInt8(111);
      program.bendRangeMinus = dataview.getInt8(112);

      program.joystickAssignPlus = dataview.getInt8(113);
      program.joystickRangePlus = dataview.getInt8(114);
      program.joystickAssignMinus = dataview.getInt8(115);
      program.joystickRangeMinus = dataview.getInt8(116);
      program.cvInMode = dataview.getInt8(117);
      program.cvIn1AssignPlus = dataview.getInt8(118);
      program.cvIn1RangePlus = dataview.getInt8(119);
      program.cvIn2AssignMinus = dataview.getInt8(120);
      program.cvIn2RangeMinus = dataview.getInt8(121);
      program.microTuning = dataview.getInt8(122);
      program.scaleKey = dataview.getInt8(123);
      program.programTuning = dataview.getInt8(124);
      program.lfoKeySync = dataview.getInt8(125);
      program.lfoVoiceSync = dataview.getInt8(126);
      program.lfoTargetOsc = dataview.getInt8(127);
      program.cutoffVelocity = dataview.getInt8(128);
      program.ampVelocity = dataview.getInt8(129);
      program.multiOctave = dataview.getInt8(130);
      program.multiRouting = dataview.getInt8(131);
      program.egLegato = dataview.getInt8(132);
      program.portamentoMode = dataview.getInt8(133);
      program.portamentoBpmSync = dataview.getInt8(134);
      program.programLevel = dataview.getInt8(135);
      program.vpmParam1 = dataview.getInt8(136); // feedback
      program.vpmParam2 = dataview.getInt8(137); // noise depth
      program.vpmParam3 = dataview.getInt8(138); // shapemodeint
      program.vpmParam4 = dataview.getInt8(139); // mod attack
      program.vpmParam5 = dataview.getInt8(140); // mod decay
      program.vpmParam6 = dataview.getInt8(141); // modkeytrack
      program.userParam1 = dataview.getInt8(142);
      program.userParam2 = dataview.getInt8(143);
      program.userParam3 = dataview.getInt8(144);
      program.userParam4 = dataview.getInt8(145);
      program.userParam5 = dataview.getInt8(146);
      program.userParam6 = dataview.getInt8(147);

      return program;
    },
  },
};
</script>
